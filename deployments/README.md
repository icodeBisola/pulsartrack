# Deployments

This directory stores deployment records produced by `scripts/deploy.sh`. Each successful deployment writes a JSON file here capturing every contract ID, the target network, and a timestamp.

## File Naming Convention

```
deployed-<network>-<timestamp>.json
```

Examples:
- `deployed-testnet-1714000000.json`
- `deployed-mainnet-1714000000.json`

The timestamp is a Unix epoch (seconds) recorded at the moment `deploy.sh` finishes. When multiple deployments exist, the **highest timestamp is the current one**.

## File Format

See [`deployed-testnet-example.json`](./deployed-testnet-example.json) for a full annotated example.

Top-level fields:

| Field | Type | Description |
|---|---|---|
| `network` | string | `"testnet"` or `"mainnet"` |
| `deployedAt` | string | ISO-8601 UTC timestamp |
| `deployedBy` | string | Stellar public key of the deployer |
| `contracts` | object | Map of contract name → deployment detail |

Each entry inside `contracts` contains:

| Field | Type | Description |
|---|---|---|
| `contractId` | string | Soroban contract ID (56-char `C…` address) |
| `wasmHash` | string | SHA-256 hash of the uploaded Wasm blob |
| `txHash` | string | Transaction hash of the `create` call |

## How to Use the Contract IDs

After a fresh deployment copy the IDs into your environment files:

**Frontend** (`frontend/.env.local`):
```
NEXT_PUBLIC_CONTRACT_CAMPAIGN_ORCHESTRATOR=C...
NEXT_PUBLIC_CONTRACT_AD_REGISTRY=C...
# ... one variable per contract
```

**Backend** (`backend/.env`):
```
CONTRACT_CAMPAIGN_ORCHESTRATOR=C...
CONTRACT_AD_REGISTRY=C...
# ... one variable per contract (see backend/.env.example for full list)
```

You can also pipe the JSON through `jq` to extract all IDs at once:

```bash
jq -r '.contracts | to_entries[] | "\(.key)=\(.value.contractId)"' \
  deployments/deployed-testnet-<timestamp>.json
```

## Upgrade History

Each deployment file is a point-in-time snapshot. Keeping all files in version control gives you a full history of which Wasm hash was live at any given time, which is useful when investigating regressions or rolling back.

## Directory Contents

| File | Purpose |
|---|---|
| `.gitkeep` | Ensures the empty directory is tracked by Git |
| `README.md` | This file |
| `deployed-testnet-example.json` | Template showing the expected format with dummy values |
| `deployed-testnet-<timestamp>.json` | Real deployment records (generated by `scripts/deploy.sh`) |